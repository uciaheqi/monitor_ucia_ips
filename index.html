<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel UCI · Dashboard con Google Sheets</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Estilos -->
    <link rel="stylesheet" href="assets/css/styles.css">

    <!-- Librerías externas -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Google APIs -->
    <script src="https://apis.google.com/js/api.js" async defer onload="gapiLoaded()"></script>
    <script src="https://accounts.google.com/gsi/client" async defer onload="gisLoaded()"></script>
</head>
<body>
    <header class="topbar">
        <div class="topbar-left">
            <h1>Panel UCI · Ingavi (ejemplo)</h1>
            <p class="subtitle">Demo sin Apps Script, con lectura y escritura directa a Google Sheets mediante OAuth</p>
        </div>
        <div class="topbar-right">
            <button id="btn-auth" class="btn primary" disabled>Conectar con Google</button>
            <span id="auth-status" class="auth-status">Desconectado</span>
        </div>
    </header>

    <main class="layout">
        <section class="panel panel-meta">
            <h2>Configuración de conexión</h2>
            <p>
                Este ejemplo asume que ya configuró un proyecto en Google Cloud, habilitó la API de Google Sheets
                y creó un cliente OAuth para aplicaciones web. Debe completar las constantes en <code>assets/js/app.js</code>.
            </p>
            <ul class="config-list">
                <li><strong>CLIENT_ID</strong> del tipo <code>xxxxxxxx.apps.googleusercontent.com</code></li>
                <li><strong>API_KEY</strong> asociada al proyecto</li>
                <li><strong>SHEET_ID</strong> de la hoja de cálculo con la base UCI</li>
                <li><strong>SHEET_NAME</strong> con el nombre de la pestaña, por ejemplo <code>BASE_UCI</code></li>
            </ul>
            <p>
                Una vez completados estos valores y publicado el repositorio en GitHub Pages, podrá usar este panel
                sin necesidad de Apps Script, siempre que el usuario se autentique con una cuenta que tenga acceso
                de lectura y escritura a la hoja de cálculo.
            </p>
        </section>

        <section class="panel panel-kpis">
            <h2>Indicadores rápidos</h2>
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-label">Pacientes en base</div>
                    <div class="kpi-value" id="kpi-total">0</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Edad promedio</div>
                    <div class="kpi-value" id="kpi-edad-prom">0</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Porcentaje mujeres</div>
                    <div class="kpi-value" id="kpi-mujeres">0 %</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Tasa de mortalidad</div>
                    <div class="kpi-value" id="kpi-mortalidad">0 %</div>
                </div>
            </div>
        </section>

        <section class="panel panel-filtros">
            <h2>Filtros básicos</h2>
            <div class="filters-grid">
                <div class="form-group">
                    <label for="f-fecha-desde">Fecha ingreso desde</label>
                    <input type="date" id="f-fecha-desde">
                </div>
                <div class="form-group">
                    <label for="f-fecha-hasta">Fecha ingreso hasta</label>
                    <input type="date" id="f-fecha-hasta">
                </div>
                <div class="form-group">
                    <label for="f-sexo">Sexo</label>
                    <select id="f-sexo">
                        <option value="">Todos</option>
                        <option value="F">Femenino</option>
                        <option value="M">Masculino</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="f-estado">Condición de egreso</label>
                    <select id="f-estado">
                        <option value="">Todos</option>
                        <option value="VIVO">Vivo</option>
                        <option value="FALLECIDO">Fallecido</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button id="btn-aplicar-filtros" class="btn secondary">Aplicar filtros</button>
                    <button id="btn-reset-filtros" class="btn ghost">Limpiar</button>
                </div>
            </div>
        </section>

        <section class="panel panel-graficos">
            <h2>Gráficos de apoyo</h2>
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>Ingresos por mes</h3>
                    <canvas id="chart-ingresos"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Distribución por grupo etario</h3>
                    <canvas id="chart-edad"></canvas>
                </div>
            </div>
        </section>

        <section class="panel panel-tabla">
            <h2>Base de pacientes</h2>
            <div class="table-wrapper">
                <table id="tabla-pacientes">
                    <thead>
                        <tr id="tabla-header"></tr>
                    </thead>
                    <tbody id="tabla-body">
                        <!-- Filas dinámicas -->
                    </tbody>
                </table>
            </div>
        </section>

        <section class="panel panel-form">
            <h2>Registrar nuevo caso</h2>
            <p class="help-text">
                Este formulario es ilustrativo. Debe ajustar los nombres de las variables para que coincidan con las
                columnas de su hoja de cálculo. El mismo mecanismo se puede ampliar con más campos clínicos.
            </p>
            <form id="form-registro" autocomplete="off">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="r-historia">Nro. Historia clínica</label>
                        <input type="text" id="r-historia" required>
                    </div>
                    <div class="form-group">
                        <label for="r-fecha-ingreso">Fecha ingreso UCI</label>
                        <input type="date" id="r-fecha-ingreso" required>
                    </div>
                    <div class="form-group">
                        <label for="r-fecha-egreso">Fecha egreso UCI</label>
                        <input type="date" id="r-fecha-egreso">
                    </div>
                    <div class="form-group">
                        <label for="r-edad">Edad</label>
                        <input type="number" id="r-edad" min="0" max="120">
                    </div>
                    <div class="form-group">
                        <label for="r-sexo">Sexo</label>
                        <select id="r-sexo">
                            <option value="">Sin dato</option>
                            <option value="F">Femenino</option>
                            <option value="M">Masculino</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="r-estado">Condición de egreso</label>
                        <select id="r-estado">
                            <option value="">Sin dato</option>
                            <option value="VIVO">Vivo</option>
                            <option value="FALLECIDO">Fallecido</option>
                        </select>
                    </div>
                    <div class="form-group full">
                        <label for="r-notas">Notas clínicas breves</label>
                        <textarea id="r-notas" rows="2"></textarea>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn primary">Guardar en Google Sheets</button>
                    <span id="registro-status" class="status-label"></span>
                </div>
            </form>
        </section>
    </main>

    <footer class="footer">
        <p>Ejemplo técnico para Diego, integración directa GitHub Pages con Google Sheets usando OAuth y Google Identity Services.</p>
    </footer>

    <script src="assets/js/app.js"></script>
</body>
</html>
